<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jsonë‹¤ë£¨ê¸°(í™˜ìœ¨)</title>
</head>
<body>
    <select name="" id="sel_contry" onchange="f_changeContry()">
        <option value="" selected>== ë‚˜ë¼ì„ íƒ ==</option>
    </select>
    <div class="" style="width: 300px; height: 600px; overflow-y:scroll;">
        <table >
            <thead>
                <tr>
                    <td>ë‚˜ë¼ | </td>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ë‚ ì§œ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | </td>
                    <td>&nbsp;&nbsp;&nbsp;í™˜ìœ¨&nbsp;&nbsp;&nbsp; | </td>
                </tr>
            </thead>
            <tbody id="country_sel_tbody">
            </tbody>
        </table>
    </div>








    <script>
        
        // data ê°€ì ¸ì˜¤ê¸°
        const c_data = localStorage.getItem("exData");
        // console.log("ğŸš€ ~ file: 02_JSONë‹¤ë£¨ê¸°(í™˜ìœ¨).html:15 ~ c_data", c_data)
        
        // json Stringì„ json ê°ì²´ë¡œ ë³€í™˜
        const c_json = JSON.parse(c_data);
        console.log("ğŸš€ ~ file: 02_JSONë‹¤ë£¨ê¸°(í™˜ìœ¨).html:19 ~ c_json", c_json)
        
        // ë°ì´í„° í™•ì¸í•´ë³´ê³  ì›í•˜ëŠ” ë°ì´í„°ë§Œ ë½‘ê¸°
        const c_rate = c_json["rates"];
        console.log("ğŸš€ ~ file: 02_JSONë‹¤ë£¨ê¸°(í™˜ìœ¨).html:23 ~ c_rate", c_rate)

        // c_rateì˜ í‚¤ëª©ë¡ ì—´ëŒ(ë‚ ì§œ ëª©ë¡)
        const dateList = Object.keys(c_rate);
        console.log("ğŸš€ ~ file: 02_JSONë‹¤ë£¨ê¸°(í™˜ìœ¨).html:27 ~ dateList", dateList)

        // í†µí™” ëª©ë¡ ì—´ëŒ(êµ­ê°€ ëª©ë¡)
        const countryList = Object.keys(c_rate[dateList[0]]);
        console.log("ğŸš€ ~ file: 02_JSONë‹¤ë£¨ê¸°(í™˜ìœ¨).html:31 ~ countryList", countryList)

        // í•œêµ­ì€ KRW
        // KRWì— í•´ë‹¹í•˜ëŠ” í™˜ìœ¨ ë°ì´í„°ë§Œ ìˆ˜ì§‘
        // v_krwList[0] = {"date" : 2020-01-01, "rate" : 1100}
        // v_krwList[1] = {"date" : 2020-01-02, "rate" : 1200}
        // ì´ëŸ°ì‹ìœ¼ë¡œ ë½‘ì•„ë´ë¼
        let v_krwList = [];
        
        for(let i = 0; i < dateList.length; i++){
            let v_krwJson = {};
            v_krwJson.date = dateList[i]
            v_krwJson["rate"] = c_rate[dateList[i]]["KRW"]
            v_krwList.push(v_krwJson);
        }
        console.log(v_krwList);

        // { "KRW" : [ {"date" : 2020-01-01, "rate" : 1300}, ... {"date": 2021-01-01, "rate:" 1300}] }
        let v_krw = {"KRW" : v_krwList};
        console.log("ğŸ˜€ ~ v_krw", v_krw)

        // ëª¨ë“  ë‚˜ë¼ì— ëŒ€í•´ì„œ 
        // { "KRW" : [ {"date" : 2020-01-01, "rate" : 1300}, ... {"date": 2021-01-01, "rate:" 1300}] 
        // , "JPY" : [ {"date" : 2020-01-01, "rate" : 130}, ... {"date": 2021-01-01, "rate:" 130}]  }
        let allRate = {};

        // ë‚˜ë¼ì´ë¦„ë§Œí¼ ë°˜ë³µë¬¸
        for(let i = 0; i < countryList.length; i++){
            // ë‚ ì§œë§Œí¼ ë°˜ë³µë¬¸
            let temp_array = []
            for(let j = 0; j < dateList.length; j++){
                let v_krwJson = {};
                v_krwJson.date = dateList[j]
                v_krwJson["rate"] = c_rate[dateList[j]][countryList[i]]
                temp_array.push(v_krwJson);
            }
            allRate[countryList[i]] = temp_array
        }
        console.log("ğŸ˜€ ~ allRate", allRate)

        // JPYê°€ ê°€ì¥ ë¹„ìŒ‹ë˜ ë‚ ì§œì™€ ê°€ê²©
        // JPYê°€ ê°€ì¥ ìŒŒë˜ ë‚ ì§œì™€ ê°€ê²©
        // JPY í™˜ìœ¨ í‰ê· 

        let jpyRate = allRate["JPY"];
        console.log("ğŸ˜€ ~ jpyRate", jpyRate)

        // ë§¥ìŠ¤..
        let maxJpyRate = jpyRate[0]['rate']
        let maxJpyJson = {}
        console.log("ğŸ˜€ ~ maxJpyRate ì²˜ìŒ : ", maxJpyRate)

        // ë¡œìš°..
        let miniJpyRate = jpyRate[0]['rate']
        let miniJpyJson = {}
        console.log("ğŸ˜€ ~ miniJpyRate ì²˜ìŒ : ", miniJpyRate)

        // í‰ê· ..
        let totalJpyRate = 0;
        let averageJpyRate = 0;

        // ë§¥ìŠ¤ê°’ êµ¬í•˜ê¸°
        // ë¡œìš°ê°’ êµ¬í•˜ê¸°
        for(let i = 0; i < jpyRate.length; i++){
            if(jpyRate[i]['rate'] > maxJpyRate){
                maxJpyRate = jpyRate[i]['rate'];
                maxJpyJson = jpyRate[i];
            }
            if(jpyRate[i]['rate'] < miniJpyRate){
                miniJpyRate = jpyRate[i]['rate'];
                miniJpyJson = jpyRate[i]
            }

            totalJpyRate += jpyRate[i]['rate'];
            averageJpyRate = (Math.round((totalJpyRate / jpyRate.length) * 100)) / 100;

        }
        console.log("ğŸ˜€ ~ maxJpyRate ë¡œì§ í›„ : ", maxJpyRate)
        console.log("ğŸ˜€ ~ JPY í™˜ìœ¨ì´ ê°€ì¥ ë¹„ìŒŒë˜ ë‚ ì§œì™€ ê°€ê²© : maxJpyJson >> ", maxJpyJson)
        console.log("ğŸ˜€ ~ miniJpyRate", miniJpyRate)
        console.log("ğŸ˜€ ~ JPY í™˜ìœ¨ì´ ê°€ì¥ ìŒŒë˜ ë‚ ì§œì™€ ê°€ê²© : miniJpyJson >> ", miniJpyJson)
        console.log("ğŸ˜€ ~ totalJpyRate", totalJpyRate)
        console.log("ğŸ˜€ ~ JPYì˜ í™˜ìœ¨ í‰ê·  : averageJpyRate >> ", averageJpyRate)

    </script>

    <script>

        // ì „ì—­ë³€ìˆ˜ ì„ ì–¸
        let selContry = document.getElementById("sel_contry");
        console.log("ğŸ˜€ ~ selContry", selContry)
        let countrySelTbody = document.getElementById("country_sel_tbody");


        // ì…€ë ‰ë°•ìŠ¤ê°€ ë°”ë€”ë•Œë§ˆë‹¤ì˜ í•¨ìˆ˜
        function f_changeContry(){
            // alert("f_changeContry");
            // ì˜µì…˜ì˜ ë°¸ë¥˜ê°’ ì¶”ì¶œ
            let country_value = selContry.value;
            // console.log("ğŸ˜€ ~ country_value", country_value)

            // ì•ˆì˜ ë‚´ìš© ë¹„ì›Œì£¼ê¸°
            countrySelTbody.innerHTML = "";
            let temp_table_html = "";
            for(let key in allRate){
                // console.log("JSON í¬ì¸ë¬¸ : " , key, allRate[key]);
                // í‚¤ê°’ê³¼ ë‚˜ë¼ê°€ ì¼ì¹˜
                if(key == country_value){
                    // ë°°ì—´ ëŒë¦¬ê¸°
                    for(let i = 0; i < allRate[key].length; i++){

                        temp_table_html += `<tr><td>${key} 
                                        | </td><td>${allRate[key][i]["date"]} 
                                        | </td><td>${allRate[key][i]["rate"]} | </td></tr>`

                        
                    }
                    
                }
            }
            countrySelTbody.innerHTML += temp_table_html;

        }


        // ë‚˜ë¼ ì„ íƒ ë°•ìŠ¤ì— ê°’ ë„£ê¸°
        window.onload = function(){
            
            /*  for(let i = 0; i < countryList.length; i++){
                selContry.innerHTML += `<option value="${countryList[i]}">== ${countryList[i]} ==</option>`
                // ëœë”ë§ í•  ë–„ í¬ë¬¸ì„ í•œë²ˆì— ë‹¤ë‹¤ë‹¤ë‹¥ ë„£ìœ¼ë©´ ì•ˆì¢‹ë‹¤
            } */

            // ë¬¸ìì—´ì— ë”í•´ì¤€ë‹¤ìŒ
            // ëœë”ë§ì€ í•œë²ˆë§Œ í•˜ëŠ”ê²Œ ì¢‹ë‹¤
            let v_temp = "";
            for(let i = 0; i < countryList.length; i++){
                v_temp += `<option value="${countryList[i]}">== ${countryList[i]} ==</option>`
            }
            selContry.innerHTML += v_temp

        }

    </script>






</body>
</html>