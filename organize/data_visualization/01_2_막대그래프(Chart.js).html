<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§‰ëŒ€ê·¸ë˜í”„(Chart)</title>
</head>
<body>

    <div style="width: 400px; height: 300px;">
        <canvas id="myChart" width="100" height="60"></canvas>
    </div>
    <input type="button" value="javascriptì¶”ê°€" onclick="f_addJS()">


    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ctx = document.getElementById("myChart");

        // csv íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°~~ ajaxë¡œ
        let v_ajax = new XMLHttpRequest();
        // ê²Ÿë°©ì‹ ì˜¤í”ˆ
        v_ajax.open("GET", "./03_3_score.csv");
        // í†µì‹ ìš”ì²­
        v_ajax.send()
        
        // ì „ì—­ë³€ìˆ˜ë€
        let v_name = [];
        let v_javaScore = [];
        let v_databaseScore = [];
        let v_javascriptScore = [];
        let myChart = null;

        // v_ajaxê°€ ë¡œë“œë˜ë©´
        v_ajax.onload = function(){
            console.log("ğŸ˜€ ~ v_ajax.response", v_ajax.response)
            let v_result = v_ajax.response;

            // ê³„í–‰ë¬¸ìë¡œ ë‚˜ëˆ ì¤Œ
            let v_lines = v_result.split("\n");

            for(let i = 1; i < v_lines.length; i++){
                // console.log("v_lines[i] : " , v_lines[i]);
                let v_temp = v_lines[i].split(", ");
                console.log(v_temp[0]); // ì´ë¦„
                console.log(v_temp[1]); // ìë°”
                console.log(v_temp[2]); // DB
                console.log(v_temp[3]); // JS

                v_name.push(v_temp[0]);
                v_javaScore.push(v_temp[1]);
                v_databaseScore.push(v_temp[2]);
                v_javascriptScore.push(v_temp[3]);
            }

            console.log("ğŸ˜€ ~ v_lines[0]", v_lines[0]); // ê³¼ëª©ë“¤
            console.log("ğŸ˜€ ~ v_lines[1].split(", ");", v_lines[1].split(", ")); // ê¸°ìœ¤
            console.log("ğŸ˜€ ~ v_lines[2].split(", ");", v_lines[2].split(", ")); // ì¬í˜„

            // ë¹„ë™ê¸° ì•„ì‘ìŠ¤ í†µì‹ ì´ê¸° ë•Œë¬¸ì—
            // ì•„ì‘ìŠ¤ê°€ ì˜¨ë¡œë“œ ë˜ê¸°ì „ì— ë°–ì— ë†”ë‘ë©´
            // ê°’ì´ ì—†ëŠ”ê²ƒë“¤ì„ ê·¸ë¦°ë‹¤
            // ë‹¤ë¥¸ê³³ì—ì„œ ì°¨íŠ¸ë¥¼ ì§‘ìœ¼ë ¤ë©´ ë³€ìˆ˜ëª…ì„ ì§€ì–´ì¤˜ì•¼ í•œë‹¤
            myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: v_name,
                    datasets: [{
                        label: 'Java',
                        data: v_javaScore
                    }, {
                        label: 'Databse',
                        data : v_databaseScore
                    }]
                }

            });
        }

        // ìë°”ìŠ¤í¬ë¦½íŠ¸ ì ìˆ˜ ì¶”ê°€í•˜ëŠ” ë²„íŠ¼
        function f_addJS(){
            // .data >> ê°’ ì˜ë‚˜ì˜´
            console.log(myChart["data"]);
            // .typeëŠ” ë˜ ì•ˆë˜ë„¤
            console.log(myChart.type);

            // ì´ë¯¸ í•œë²ˆ ë§Œë“¤ì–´ì§„ Chartê°ì²´ë¥¼ ìˆ˜ì •í•˜ëŠ” ë°©ì‹
            myChart["data"]["datasets"].push({
                label: 'Javascript',
                data: v_javascriptScore
            });
            // ë³€ê²½ëœ ì‚¬í•­ì„ ë°˜ì˜í•˜ëŠ” ë©”ì†Œë“œ update();
            myChart.update();
            
            // ë²„íŠ¼ í•œë²ˆë§Œ ëˆŒë¦¬ê²Œ ì–´ì¼€í•¨
        }


    </script>
    
</body>
</html>