<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í™˜ìœ¨ì‹œê°í™”</title>
</head>
<body>
    <h3>í•œêµ­ í™˜ìœ¨ ì¶”ì„¸</h3>
    <div style="width: 700px; height: 560px;">
        <canvas id="myChart" width="100" height="80"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ctx = document.getElementById("myChart");
        const c_data = localStorage.getItem("exData");
        // console.log("ğŸ˜€ ~ c_data", c_data)

        const v_data = JSON.parse(c_data);
        //console.log("ğŸ˜€ ~ v_data", v_data)

        // í™˜ìœ¨ë°ì´í„°
        let r_data = v_data["rates"];
        console.log("ğŸ˜€ ~ r_data", r_data)

        // ë‚ ì§œ
        let dateSet = Object.keys(r_data);
        console.log("ğŸ˜€ ~ dateSet", dateSet)

        let krwRate = [];
        // r_data ì ‘ê·¼
        for(let keys in r_data){
            krwRate[krwRate.length] = r_data[keys]["KRW"];
        }

        //console.log("ğŸ˜€ ~ krwRate", krwRate)


        // íœ ì„ êµ´ë¦¬ë©´ ì°¨íŠ¸ ë³€í•˜ëŠ” ì´ë²¤íŠ¸
        let v_state = 0;        // v_stateê°€ 0ì´ë©´ yearë‹¨ìœ„, 1ì´ë©´ 3ë‹¬, 2ì´ë©´ 1ë‹¬, 3ì´ë©´ 1ì£¼ì¼ì— ëŒ€í•´ ê·¸ë ¤ì¤Œ
        ctx.addEventListener("wheel", function(e){
            // íœ ì„ ì˜¬ë¦¬ë©´ e.wheelDeltaì— 150ì´ ë‹´ê¸°ê³ 
            // ë‚´ë¦¬ë©´ -150ì´ ë‹´ê¸´ë‹¤.

            // íœ ì„ ì˜¬ë¦¬ë©´
            if(e.wheelDelta > 0){
                if(v_state > 2){
                    v_state = 3;
                }else{
                    v_state++;
                }
            // íœ ì„ ë‚´ë¦¬ë©´
            }else if(e.wheelDelta < 0){
                if(v_state < 1){
                    v_state = 0;
                }else{
                    v_state--;
                }
            }

            // ê·¸ë¦¬ëŠ” í•¨ìˆ˜
            console.log(v_state);
            f_draw(v_state);

        });

        // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        let myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: dateSet,
                datasets: [{
                    label: "KRW",
                    data: krwRate,
                    pointRadius: 0,
                    borderColor: 'pink'
                }]
            },
            options: {
                elements: {
                    line: {
                        tension: 0.4
                    }
                },
                plugins: {
                    legend: {
                        display : false
                    }
                }
            }
        });

        // ë°ì´í„°ì˜ ê°€ì¥ ìµœê·¼ ë‚ ì§œì—ì„œ p_numì„ ëº€ ë‚ ë¶€í„° ê°€ì¥ ìµœê·¼ ë‚ ì§œê¹Œì§€ ë°˜ë³µë¬¸ í•¨ìˆ˜
        // krw í™˜ìœ¨ì— ëŒ€í•œ
        function f_inputDate(p_num, p_r_data, p_dateSet, p_v_labels, p_v_data){
            for(let i = p_dateSet.length - p_num; i < p_dateSet.length; i++){
                    p_v_labels.push(p_dateSet[i]);
                    p_v_data.push(p_r_data[p_dateSet[i]]["KRW"]);
                }
        }

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function f_draw(p_state){
            let v_labels = [];
            let v_data = [];
            console.log(dateSet);
            if(p_state == 0){
                // 1ë…„ì¹˜ ê·¸ë¦¼
                // ë‚ ì§œ
                f_inputDate(dateSet.length, r_data, dateSet, v_labels, v_data);
            }else if(p_state == 1){
                // 3ë‹¬ì¹˜ ê·¸ë¦¼   >> 90ì¼
                // ë‚ ì§œ
                f_inputDate(90, r_data, dateSet, v_labels, v_data);
            }else if(p_state == 2){
                // 1ë‹¬ì¹˜ ê·¸ë¦¼
                f_inputDate(30, r_data, dateSet, v_labels, v_data);
            }else if(p_state == 3){
                // 1ì£¼ì¼ì¹˜ ê·¸ë¦¼
                f_inputDate(7, r_data, dateSet, v_labels, v_data);
            }
            console.log("v_labels",v_labels);
            console.log("v_data",v_data);

            myChart.data.labels = v_labels;
            myChart.data.datasets[0]["label"] = v_data;
            myChart.update();
        }

    </script>
    
</body>
</html>