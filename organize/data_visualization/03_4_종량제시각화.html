<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¢…ëŸ‰ì œì‹œê°í™”</title>
</head>
<body>
    <h3>ì¢…ëŸ‰ì œ ì‹œê°í™”</h3>
    <div style="width: 400px; height: 360px;">
        <canvas id="myChart" width="100" height="80"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>

        
        // ë‚˜ëŠ” ë°°ì—´ì— ë‹¤ ë‹´ì•„ì„œ í–ˆëŠ”ë°..
        // ë°°ì—´ì„ ì¼ì¼íˆ ë‹¤ ë§Œë“œëŠ”ê²Œ ì•„ë‹ˆë¼
        // json í•˜ë‚˜ì— ë‹´ì•˜ìœ¼ë©´ ë” í¸í–ˆë‹¤

        // ì „ì—­ë³€ìˆ˜ ì„ ì–¸
        const ctx = document.getElementById("myChart");
        let seoul = [];
        let deajon = [];
        let deagoo = [];
        let busan = [];
        let gwangju = [];
        // ëª¨ë“  ë„ì‹œ ê°ì²´ë¥¼ ë‹´ì€ ë°°ì—´
        let totalCity = [seoul, deajon, deagoo, busan, gwangju];
        // ë„ì‹œëª…
        let nameCity = ["ì„œìš¸íŠ¹ë³„ì‹œ", "ëŒ€ì „ê´‘ì—­ì‹œ", "ëŒ€êµ¬ê´‘ì—­ì‹œ", "ë¶€ì‚°ê´‘ì—­ì‹œ", "ê´‘ì£¼ê´‘ì—­ì‹œ"];

        // ë¦¬í„°ì— ë”°ë¥¸ ë´‰íˆ¬ í‰ê· ê°’
        let tenTrash = [];
        let twentyTrash = [];
        let fiftyTrash = [];
        let hundredTrash = [];
        let averageTrashArray = [tenTrash, twentyTrash, fiftyTrash, hundredTrash]
        // ë¦¬í„°ëª…
        let trashName = ["10â„“ê°€ê²©", "20â„“ê°€ê²©", "50â„“ê°€ê²©", "100â„“ê°€ê²©"];



        // ajaxë¡œ ë¡œì»¬ jsoníŒŒì¼ ê°€ì ¸ì˜¤ê¸°
        let v_ajax = new XMLHttpRequest();
        v_ajax.open("GET", "./01_price.json")
        v_ajax.send();
        // ajax ë¡œë”© ì™„ë£Œ
        v_ajax.onload = function(){
            console.log(v_ajax.response);
            // json ìŠ¤íŠ¸ë§ì´ë©´ jsonìœ¼ë¡œ íŒŒì‹±í•´ì•¼ì§€~
            result = JSON.parse(v_ajax.response);
            console.log(result);
            console.log(result.fields);

            // ëª¨ë“  ë„ì‹œ ë°°ì—´ì— ë‹¤ ë‹´ê¸°
            input_array_city(nameCity, totalCity, result);

            console.log("ğŸ˜€ ~ totalCity[0]", totalCity[0])  // ì„œìš¸

            // ì„œìš¸ 10l í‰ê· 
            let seoulTenArray = arrayTrashEnvelope(totalCity[0], "10â„“ê°€ê²©");
            console.log("ğŸ˜€ ~ seoulTenArray", seoulTenArray)

            // ë„ì‹œë“¤ì˜ ëª¨ë“  ì“°ë ˆê¸°ë´‰íˆ¬ 10l í‰ê· ê°’ ë°°ì—´ì— ë‹´ê¸°
            for(let j = 0; j < trashName.length; j++){
                for(let i = 0; i < totalCity.length; i++){
                    let tempAverage = arrayTrashEnvelope(totalCity[i], trashName[j]);
                    averageTrashArray[j].push(tempAverage);
                }
            }
            // ì˜ ë‹´ê²¼ë‚˜ í™•ì¸
            console.log("ğŸ˜€ ~ averageTrashArray", averageTrashArray)

            // í•¨ìˆ˜ ì‹¤í–‰
            f_draw(result);
        }

        // ê·¸ë¦¬ëŠ” í•¨ìˆ˜
        function f_draw(p_data){
            console.log("p_data : ", p_data);

            // í•˜ë“œì½”ë”© ì¤„ì´ê³  ê·¸ë¦¬ê¸°
            let arrayData = [];
            for(let i = 0; i < trashName.length; i++){
                let tempJSON = {};
                tempJSON["label"] = trashName[i];
                tempJSON["data"] = averageTrashArray[i];
                arrayData.push(tempJSON);
            }

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: nameCity,
                    // datasetsì´ ë°°ì—´ì´ë¼ëŠ”ê²Œ ì¤‘ìš”í•˜ë‹¤!!!
                    // ë°°ì—´ì— ë¯¸ë¦¬ ë‹´ì•„ë‘ë©´ í™• ì¤„ì¼ ìˆ˜ ìˆë‹¤.
                    datasets: arrayData
                }
            });
            // ì„œìš¸, ëŒ€ì „, ëŒ€êµ¬, ë¶€ì‚°, ê´‘ì£¼ ì§€ì—­ì˜
            // 10L, 20L, 50L, 100L ì“°ë ˆê¸° ë´‰íˆ¬ ê°€ê²©ì„ ë§‰ëŒ€ê·¸ë˜í”„ë¡œ í‘œí˜„
            // ì„œìš¸ 10L í‰ê· ê°€ê²©, 20L í‰ê·  ê°€ê²©..

            // xì¶•ì´ ì„œìš¸, ëŒ€ì „, ëŒ€êµ¬, ë¶€ì‚°, ê´‘ì£¼
            // ê·¸ ì¶•ì•ˆì— 10Lí‰ê· , 20Lí‰ê· ...
            // ë‚´ê°€ êµ¬í•´ì•¼ í•˜ëŠ”ê²ƒì€ ê°ì§€ì—­ì˜ 10L, 20L, .. í‰ê· 
        }

        // ë„ì‹œì— ë”°ë¥¸ json ë°°ì—´ì— ì§‘ì–´ë„£ê¸°
        function input_array_city(p_name, p_city, p_data){
            for(let j = 0; j < p_name.length; j++){

                for(let i = 0; i < p_data["records"].length; i++){
                    if(p_data["records"][i]["ì‹œë„ëª…"] == p_name[j]){
                        p_city[j].push(p_data["records"][i]);
                    }
                }
            }
        }

        // ë„ì‹œì˜ ë¦¬í„°ê°’ì— ë”°ë¥¸ ë´‰íˆ¬ í‰ê· ê°’ êµ¬í•˜ê¸° >> ë´‰íˆ¬ê°’ì´ 0ì´ë©´ ë‚˜ëˆŒë•Œ ë¹¼ì¤Œ

        function arrayTrashEnvelope(p_city, p_trash){
            let totalPrice = 0;
            let realCityLength = p_city.length;
            for(let i = 0; i < p_city.length; i++){
                totalPrice += (p_city[i][p_trash]) * 1;
                // 0ì¼ë•Œ ê¸¸ì´ì—ì„œ ë¹¼ê¸°
                if((p_city[i][p_trash]) == 0){
                    realCityLength--;
                }
            }
            let tempArray = totalPrice / realCityLength;
            return tempArray;
        }

    </script>




</body>
</html>