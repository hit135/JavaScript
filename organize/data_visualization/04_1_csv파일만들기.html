<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.1.js"></script>
    <title>csv íŒŒì¼ ë§Œë“¤ê¸°</title>
</head>
<body>

    <div class="contains">
        <input id="excelDownload" type="button" value="í™˜ìœ¨ csv ë‹¤ìš´">
    </div>


    
    <script>
        const c_data = localStorage.getItem('exData');
        const v_data = JSON.parse(c_data)["rates"];
        // console.log("ğŸ˜€ ~ v_data", v_data);
        // ë‚ ì§œ ë¦¬ìŠ¤íŠ¸
        const dateList = Object.keys(v_data);
        console.log("ğŸ˜€ ~ dateList", dateList)
        let krwRate = []; // í•œêµ­ í™˜ìœ¨
        console.log("ğŸ˜€ ~ krwRate", krwRate)
        let jpyRate = []; // ì¼ë³¸ í™˜ìœ¨
        console.log("ğŸ˜€ ~ jpyRate", jpyRate)

        for(let keys in v_data){
            krwRate.push(v_data[keys]["KRW"].toFixed(2) );
            jpyRate.push(v_data[keys]["JPY"].toFixed(2) );
        }
        
        // 1. ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ 
        $("#excelDownload").click(function () {
            // alert("í´ë¦­ì…ë‹ˆë‹¹~")
            let filename = "testFile.csv";
            getCSV(filename);
        });

        // 2. csv ìƒì„± í•¨ìˆ˜ ë§Œë“¤ê¸°!
        function getCSV(filename) {
            var csv = [];
            var row = [];
            
            //1ì—´ì—ëŠ” ì»¬ëŸ¼ëª…
            row.push(
                "ë‚ ì§œ",
                "í•œêµ­ í™˜ìœ¨",
                "ì¼ë³¸ í™˜ìœ¨",
            );
            
            // .joiní•¨ìˆ˜..! .join("êµ¬ë¶„ì")
            // ë°°ì—´ ì¸ë±ìŠ¤ ì‚¬ì´ì— êµ¬ë¶„ìê°€ ë“¤ì–´ê°€ê³ 
            // í•˜ë‚˜ì˜ ë¬¸ìì—´ë¡œ ë°”ê¿”ì¤Œ
            csv.push(row.join(","));

            //chartDataListëŠ” ë°ì´í„° ë°°ì—´
            for(let i = 0; i < dateList.length; i++){
                row = [];
                row.push(dateList[i]);
                row.push(krwRate[i]);
                row.push(jpyRate[i]);

                csv.push(row.join(","));
            };

            downloadCSV(csv.join("\n"), filename);
        }

        // 3. CSV ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
        function downloadCSV(csv, filename) {
            var csvFile;
            var downloadLink;

            //í•œê¸€ ì²˜ë¦¬ë¥¼ í•´ì£¼ê¸° ìœ„í•´ BOM ì¶”ê°€í•˜ê¸°
            const BOM = "\uFEFF";
            csv = BOM + csv;

            csvFile = new Blob([csv], { type: "text/csv" });
            downloadLink = document.createElement("a");
            downloadLink.download = filename;
            downloadLink.href = window.URL.createObjectURL(csvFile);
            downloadLink.style.display = "none";
            document.body.appendChild(downloadLink);
            downloadLink.click();
        }

    </script>
    
    
</body>
</html>